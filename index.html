<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VHS Landing Page</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

<style>
  @font-face {
    font-family: 'Cubic11';
    src: url('Cubic_11.ttf') format('truetype');
  }

  html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    overflow: hidden;
    font-family: 'Cubic11', monospace;
    color: #ddd;
    position: relative;

  }

  #bg-video {
    position: fixed;
    top: 50%; left: 50%;
    min-width: 100%; min-height: 100%;
    transform: translate(-50%, -50%);
    object-fit: cover;
    z-index: -2;
    pointer-events: none;
  }

  #overlay-glow {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.3);
    mix-blend-mode: multiply;
    z-index: -1;
  }

  #lang-toggle {
    position: absolute;
    top: 15px; right: 15px;
    z-index: 3;
  }

  #lang-toggle button {
    font-family: 'Cubic11', monospace;
    font-size: 0.8em;
    margin-left: 5px;
    padding: 3px 10px;
    background: transparent;
    border: 1px solid #ddd;
    color: #ddd;
    cursor: pointer;
    text-shadow: 0 0 2px #ddd;
    transition: all .12s ease-in-out;
  }

  #lang-toggle button:hover {
    font-weight: bold;
    text-shadow: 0 0 3px #fff, 0 0 5px #aaa;
  }

  #start-screen {
    position: absolute; width:100%; height:100%;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 2; text-align: center;
  }

  h2 {
    font-size: 4em;
    letter-spacing: 2px;
    text-shadow: 0 0 5px #ddd, 0 0 10px #ddd;
    margin-bottom: 10px;
    animation: flickerText 1.5s infinite;
    text-transform: uppercase;
  }

  .menu { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; }
  .menu button {
    font-size: 1.5em;
    font-family: 'Cubic11', monospace;
    margin: 4px; padding: 8px 30px;
    background: transparent; border: none;
    color: #ddd; cursor: pointer;
    text-shadow: 0 0 3px #ddd;
    transition: all .12s ease-in-out;
    position: relative;
    overflow: hidden;
  }

  /* Subtle light flicker effect on hover */
  .menu button:hover {
    font-weight: bold;
    animation: lightFlicker 1.2s infinite;
  }

  /* Mild glitch effect - subtle position shifts */
  .menu button:hover::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.05),
      transparent
    );
    animation: mildGlitch 1.5s infinite;
    z-index: -1;
  }

  /* Light flicker effect - like a flickering light bulb */
  @keyframes lightFlicker {
    0%, 100% { 
      opacity: 1;
      text-shadow: 0 0 3px #ddd, 0 0 6px #ccc;
    }
    5% { 
      opacity: 0.95;
      text-shadow: 0 0 2px #ddd, 0 0 4px #bbb;
    }
    10% { 
      opacity: 1;
      text-shadow: 0 0 3px #ddd, 0 0 6px #ccc;
    }
    15% { 
      opacity: 0.92;
      text-shadow: 0 0 1px #ddd, 0 0 3px #aaa;
    }
    20% { 
      opacity: 1;
      text-shadow: 0 0 3px #ddd, 0 0 6px #ccc;
    }
    30% { 
      opacity: 0.98;
      text-shadow: 0 0 2.5px #ddd, 0 0 5px #bbb;
    }
    40% { 
      opacity: 1;
      text-shadow: 0 0 3px #ddd, 0 0 6px #ccc;
    }
    50% { 
      opacity: 0.94;
      text-shadow: 0 0 1.5px #ddd, 0 0 4px #aaa;
    }
    60% { 
      opacity: 1;
      text-shadow: 0 0 3px #ddd, 0 0 6px #ccc;
    }
    70% { 
      opacity: 0.96;
      text-shadow: 0 0 2px #ddd, 0 0 4px #bbb;
    }
    80% { 
      opacity: 1;
      text-shadow: 0 0 3px #ddd, 0 0 6px #ccc;
    }
    90% { 
      opacity: 0.99;
      text-shadow: 0 0 2.8px #ddd, 0 0 5.5px #bbb;
    }
  }

  /* Mild glitch effect - subtle horizontal shifts */
  @keyframes mildGlitch {
    0%, 100% { 
      transform: translateX(0);
      opacity: 0.3;
    }
    15% { 
      transform: translateX(-0.5px);
      opacity: 0.4;
    }
    30% { 
      transform: translateX(0.3px);
      opacity: 0.2;
    }
    45% { 
      transform: translateX(0.5px);
      opacity: 0.35;
    }
    60% { 
      transform: translateX(-0.3px);
      opacity: 0.25;
    }
    75% { 
      transform: translateX(0.2px);
      opacity: 0.4;
    }
    90% { 
      transform: translateX(-0.2px);
      opacity: 0.3;
    }
  }

  #room3D { display:none; width:100%; height:100%; }

  @keyframes flickerText{
    0%,100%{opacity:1}10%{opacity:.8}30%{opacity:.85}50%{opacity:1}
  }

  #loading{position:absolute;top:20px;left:20px;color:lime;background:#000c;padding:15px;border-radius:6px;display:none;z-index:100}
  #status{position:absolute;bottom:20px;left:20px;color:white;background:#000b;padding:10px;border-radius:6px;display:none;z-index:100}

  .progress-bar{width:300px;height:20px;background:#333;margin-top:10px;border-radius:10px;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,#0f0,#0c0);width:0%;transition:width .25s}

  @media(max-width:768px){
    h2{font-size:2.5em} 
    .menu button{font-size:1.1em;padding:6px 25px} 
    #lang-toggle button{font-size:.7em}
  }
  @media(max-width:480px){
    h2{font-size:1.8em} 
    .menu button{font-size:.9em;padding:5px 18px} 
    #lang-toggle button{font-size:.6em}
  }
</style>
</head>

<body>
<div id="lang-toggle">
  <button id="btn-en">English</button>
  <button id="btn-zh">中文</button>
</div>

<video id="bg-video" autoplay muted loop>
  <source src="Blank VHS Tape with Play Overlay Footage _ Free Download.mp4" type="video/mp4">
</video>
<div id="overlay-glow"></div>

<div id="start-screen">
  <h2 id="title">YIJUN RECORDS</h2>
  <div class="menu">
    <button id="btn-start">PRESS TO START</button>
    <button id="btn-resume">RESUME</button>
    <button id="btn-story">STORY</button>
    <button id="btn-settings">SETTINGS</button>
  </div>
</div>

<div id="room3D"></div>
<div id="loading">
  <div id="loading-text">Initializing…</div>
  <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
</div>
<div id="status">Click to look around • WASD to move</div>

<audio id="static-sound" loop>
  <source src="static.mp3" type="audio/mp3">
</audio>

<!-- Regular script for language switching -->
<script>
// Language switching function in global scope
function setLanguage(lang) {
  const title = document.getElementById("title");
  const btnStart = document.getElementById("btn-start");
  const btnResume = document.getElementById("btn-resume");
  const btnStory = document.getElementById("btn-story");
  const btnSettings = document.getElementById("btn-settings");
  
  if (lang === 'zh') {
    title.textContent = "异君录";
    btnStart.textContent = "开机";
    btnResume.textContent = "续播";
    btnStory.textContent = "档案";
    btnSettings.textContent = "设置";
  } else {
    title.textContent = "YIJUN RECORDS";
    btnStart.textContent = "PRESS TO START";
    btnResume.textContent = "RESUME";
    btnStory.textContent = "STORY";
    btnSettings.textContent = "SETTINGS";
  }
}

// Add event listeners when the page loads
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById("btn-en").addEventListener("click", function() {
    setLanguage('en');
  });
  
  document.getElementById("btn-zh").addEventListener("click", function() {
    setLanguage('zh');
  });
});
</script>

<!-- Module script for 3D functionality -->
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';
import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/PointerLockControls.js';

const staticAudio = document.getElementById("static-sound");
staticAudio.volume = 0.25;

const btnStart = document.getElementById("btn-start");
const btnResume = document.getElementById("btn-resume");
const btnStory = document.getElementById("btn-story");
const btnSettings = document.getElementById("btn-settings");

// START 3D
btnStart.addEventListener("click", start3DWalkthrough);

let scene, camera, renderer, controls;
const loadingDiv = document.getElementById('loading');
const loadingText = document.getElementById('loading-text');
const progressFill = document.getElementById('progress-fill');
const statusDiv = document.getElementById('status');

function updateLoading(text, percent=0){
  loadingText.textContent=text;
  progressFill.style.width=percent+'%';
}

function start3DWalkthrough(){
  document.getElementById('start-screen').style.display='none';
  document.getElementById('bg-video').style.display='none';
  document.getElementById('overlay-glow').style.display='none';
  staticAudio.currentTime = 0;
  staticAudio.play().catch(()=>console.warn("Audio blocked"));
  document.getElementById('room3D').style.display='block';
  loadingDiv.style.display='block';
  statusDiv.style.display='block';
  updateLoading("Initializing 3D engine…", 10);
  setTimeout(init3D,100);
}

function init3D(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000000);
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, .1, 1000);
  camera.position.set(0,1.6,5);
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
  document.getElementById('room3D').appendChild(renderer.domElement);
  const ambient = new THREE.AmbientLight(0xffffff,.6);
  const dir = new THREE.DirectionalLight(0xffffff,.9);
  dir.position.set(10,20,12);
  scene.add(ambient,dir);
  controls = new PointerLockControls(camera, renderer.domElement);
  renderer.domElement.addEventListener('click',()=>controls.lock());
  updateLoading("Loading model…",40);
  loadModel();
  window.addEventListener('resize',onResize);
  animate();
}

function loadModel(){
  const loader = new GLTFLoader();
  loader.load(
    'model/retro_game_room_sitescape.glb',
    (gltf)=>{
      updateLoading("Model loaded!",100);
      scene.add(gltf.scene);
      setTimeout(()=>loadingDiv.style.display='none',900);
    },
    (xhr)=>{
      const p = xhr.total ? (xhr.loaded/xhr.total)*100 : 0;
      updateLoading(`Loading model… ${Math.round(p)}%`,50+p*.4);
    },
    (err)=>{
      console.error(err);
      updateLoading("Model failed — using fallback.",90);
      const floor = new THREE.Mesh(
        new THREE.PlaneGeometry(50,50),
        new THREE.MeshStandardMaterial({color:0xffffcc,roughness:.9})
      );
      floor.rotation.x=-Math.PI/2; floor.position.y=-.5;
      scene.add(floor);
    }
  );
}

function onResize(){
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
}

function animate(){
  requestAnimationFrame(animate);
  renderer.render(scene,camera);
}
</script>
</body>
</html>